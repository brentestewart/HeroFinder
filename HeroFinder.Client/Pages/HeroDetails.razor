@rendermode InteractiveAuto

@page "/herodetails/{id:int}/{returnUrl?}"

@inherits ViewModelComponentBase<HeroDetailsViewModel>

<div class="hero-details-bg">
    @if (ViewModel.Hero == null)
    {
        <div class="loading-container">
            <div class="loading-card">
                <h2 class="loading-text">Loading hero details...</h2>
                <div class="loading-spinner"></div>
            </div>
        </div>
    }
    else
    {
        <div class="hero-details-container">
            <div class="back-button-container">
                <button class="back-button @(ViewModel.Hero.Universe == "Marvel" ? "marvel-back" : "dc-back")" @onclick="ViewModel.GoBack">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M19 12H5M12 19L5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Back
                </button>
            </div>
            <div class="hero-details-card @(ViewModel.Hero.Universe == "Marvel" ? "marvel-theme" : "dc-theme")">
                <div class="hero-image-section">
                    <div class="hero-image-wrapper">
                        <img src="@ViewModel.Hero.ImageLink" alt="@ViewModel.Hero.HeroName" class="hero-main-image" />
                        <div class="universe-badge @(ViewModel.Hero.Universe == "Marvel" ? "marvel-badge" : "dc-badge")">
                            @ViewModel.Hero.Universe
                        </div>
                        <button class="details-favorite-button @(ViewModel.Hero.IsFavorite ? "favorited" : "")"
                                @onclick="ViewModel.ToggleFavorite"
                                title="@(ViewModel.Hero.IsFavorite ? "Remove from favorites" : "Add to favorites")">
                            <svg width="28" height="28" viewBox="0 0 24 24" fill="@(ViewModel.Hero.IsFavorite ? "#FDD835" : "none")" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"
                                      stroke="@(ViewModel.Hero.IsFavorite ? "#FDD835" : "#FAFAFA")"
                                      stroke-width="2" 
                                      stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="hero-info-section">
                    <h1 class="hero-title">@ViewModel.Hero.HeroName</h1>
                    <div class="hero-details-grid">
                        <div class="detail-item">
                            <span class="detail-label">Secret Identity:</span>
                            <span class="detail-value">@ViewModel.Hero.SecretIdentity</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Universe:</span>
                            <span class="detail-value">@ViewModel.Hero.Universe</span>
                        </div>
                        <div class="detail-item abilities-item">
                            <span class="detail-label">Abilities:</span>
                            <div class="abilities-list">
                                @foreach (var ability in ViewModel.Hero.Abilities)
                                {
                                    <span class="ability-tag @(ViewModel.Hero.Universe == "Marvel" ? "marvel-ability" : "dc-ability")">@ability</span>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
</div>

@code {
    [Parameter]
    public int id { get; set; }

    [Parameter]
    public string? returnUrl { get; set; }

    [SupplyParameterFromQuery]
    public string? campaign { get; set; }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await ViewModel.LoadHeroAsync(id);
            ViewModel.SetReturnUrl(returnUrl);

            if (!string.IsNullOrWhiteSpace(campaign))
            {
                ViewModel.RegisterAdCampaign(campaign);
            }
        }

        await base.OnAfterRenderAsync(firstRender);
    }
}
